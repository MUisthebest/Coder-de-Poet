version: "3.9"

networks:
  learnix_net:

services:
  nginx:
    image: nginx:1.25-alpine
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - frontend
      - auth_service
      - course_service
      - ai_service
      - chat_service
      - ide_service
    networks:
      - learnix_net

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    restart: unless-stopped
    expose:
      - "80"
    networks:
      - learnix_net

  # .NET Auth
  auth_service:
    build:
      context: ./auth_service
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      - ASPNETCORE_URLS=http://0.0.0.0:8080
      - ASPNETCORE_ENVIRONMENT=Production
    env_file: .env.prod
    expose:
      - "8080"
    networks:
      - learnix_net

  # NestJS Course service
  course_service:
    build:
      context: ./course_service
      dockerfile: Dockerfile
    restart: unless-stopped
    env_file: .env.prod
    expose:
      - "3000"
    networks:
      - learnix_net

  # Python AI
  ai_service:
    build:
      context: ./AI_service
      dockerfile: Dockerfile
    restart: unless-stopped
    env_file: .env.prod
    expose:
      - "8000"
    networks:
      - learnix_net

  # Python Chat
  chat_service:
    build:
      context: ./chat_service
      dockerfile: Dockerfile
    restart: unless-stopped
    env_file: .env.prod
    expose:
      - "8001"
    networks:
      - learnix_net

  # .NET IDE
  ide_service:
    build:
      context: ./ide_service
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      ASPNETCORE_URLS: http://0.0.0.0:8081
      ASPNETCORE_ENVIRONMENT: Production
    env_file: .env.prod
    expose:
      - "8081"
    networks:
      - learnix_net
